--- 
title: "Causal Inference: What If. R and Stata code for Exercises"
author: 
 - Book by M. A. Hernán and J. M. Robins
 - R code by Joy Shi and Sean McGrath
 - Stata code by Eleanor Murray and Roger Logan
 - R Markdown code by Tom Palmer
date: "`r format(Sys.Date(), '%d %B %Y')`"
site: bookdown::bookdown_site
documentclass: book
#biblio-style: apalike
link-citations: yes
description: "Code examples from Causal Inference: What If by M. A. Hernán and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/"
geometry: margin=1in
fontsize: 10pt
linestretch: 1.1
bibliography: bibliography.bib
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(tidy = 'formatR', digits = 4, tidy.opts = list(width.cutoff = 60)) 
```

# Preface{-}

This book presents code examples from @ci-book, which is available in draft form from the following webpage.

https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/

The R code is based on the code by Joy Shi and Sean McGrath given [here](https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/1268/20/Rcode_CIpart2.zip).

The Stata code is based on the code by Eleanor Murray and Roger Logan given [here](https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/2019/11/stata_part2.zip).

## Packages to install
To install the R packages required for this book please copy/fork the repository. It is easiest to open the repo in RStudio as an RStudio project, by doubling click the `.Rproj` file. This makes sure that R's working directory is at the top level of the repo. If you don't want to open the repo as a project set the working directory to the top level of the repo directories using `setwd()`. Then run:
```{r eval=FALSE}
# install.packages("devtools") # uncomment if devtools not installed
devtools::install_dev_deps()
```

## Downloading the datasets
We assume that you have downloaded the data from the Causal Inference Book website and saved it to a `data` subdirectory. You can do this manually or with the following code (nb. we use the [`here`](https://here.r-lib.org/) package to reference the data subdirectory).

```{r, results='hide', message=FALSE, warning=FALSE}
library(here)
```

```{r}
dataurls <- list()
dataurls[[1]] <- 
  "https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/2012/10/nhefs_sas.zip"
dataurls[[2]] <- 
  "https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/2012/10/nhefs_stata.zip"
dataurls[[3]] <- 
  "https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/2017/01/nhefs_excel.zip"
dataurls[[4]] <- 
  "https://cdn1.sph.harvard.edu/wp-content/uploads/sites/1268/1268/20/nhefs.csv"

temp <- tempfile()
for (i in 1:3) {
  download.file(dataurls[[i]], temp)
  unzip(temp, exdir = "data")
}

download.file(dataurls[[4]], here("data", "nhefs.csv"))
```

\mainmatter
