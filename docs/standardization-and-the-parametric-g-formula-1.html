<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>13. Standardization and the parametric G-formula | Causal Inference Book: Exercises</title>
  <meta name="description" content="Code examples from the Causal Inference Book by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  <meta name="generator" content="bookdown 0.13.1 and GitBook 2.6.7" />

  <meta property="og:title" content="13. Standardization and the parametric G-formula | Causal Inference Book: Exercises" />
  <meta property="og:type" content="book" />
  
  
  <meta property="og:description" content="Code examples from the Causal Inference Book by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="13. Standardization and the parametric G-formula | Causal Inference Book: Exercises" />
  
  <meta name="twitter:description" content="Code examples from the Causal Inference Book by M. A. Hern치n and J. M. Robins https://www.hsph.harvard.edu/miguel-hernan/causal-inference-book/" />
  

<meta name="author" content="Book by M. A. Hern치n and J. M. Robins, R code by Joy Shi and Roger Logan, Stata code by Eleanor Murray, python code by , SAS code by, RMarkdown code and code tweaks by Tom Palmer" />


<meta name="date" content="2019-08-29" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="ip-weighting-and-marginal-structural-models-1.html"/>
<link rel="next" href="g-estimation-of-structural-nested-models-1.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />









<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; left: -4em; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">Table of Contents</a></li>

<li class="divider"></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Preface</a><ul>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#packages-to-install"><i class="fa fa-check"></i>Packages to install</a></li>
<li class="chapter" data-level="" data-path="index.html"><a href="index.html#location-of-datasets"><i class="fa fa-check"></i>Location of datasets</a></li>
</ul></li>
<li class="part"><span><b>R code</b></span></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html"><i class="fa fa-check"></i>11. Why model?</a><ul>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.2"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model.html"><a href="why-model.html#program-11.3"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models</a><ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.2"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.3"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.4"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.5"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.6"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models.html"><a href="ip-weighting-and-marginal-structural-models.html#program-12.7"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula</a><ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.2"><i class="fa fa-check"></i>Program 13.2</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.3"><i class="fa fa-check"></i>Program 13.3</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula.html"><a href="standardization-and-the-parametric-g-formula.html#program-13.4"><i class="fa fa-check"></i>Program 13.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models</a><ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.1"><i class="fa fa-check"></i>Program 14.1</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.2"><i class="fa fa-check"></i>Program 14.2</a><ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-one-possible-value-of-psi"><i class="fa fa-check"></i>G-estimation: Checking one possible value of psi</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-checking-multiple-possible-values-of-psi"><i class="fa fa-check"></i>G-estimation: Checking multiple possible values of psi</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#program-14.3"><i class="fa fa-check"></i>Program 14.3</a><ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-linear-mean-models"><i class="fa fa-check"></i>G-estimation: Closed form estimator linear mean models</a></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models.html"><a href="g-estimation-of-structural-nested-models.html#g-estimation-closed-form-estimator-for-2-parameter-model"><i class="fa fa-check"></i>G-estimation: Closed form estimator for 2-parameter model</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores</a><ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.1"><i class="fa fa-check"></i>Program 15.1</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.2"><i class="fa fa-check"></i>Program 15.2</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.3"><i class="fa fa-check"></i>Program 15.3</a></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores.html"><a href="outcome-regression-and-propensity-scores.html#program-15.4"><i class="fa fa-check"></i>Program 15.4</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html"><i class="fa fa-check"></i>16. Instrumental variables estimation</a><ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.1"><i class="fa fa-check"></i>Program 16.1</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.2"><i class="fa fa-check"></i>Program 16.2</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.3"><i class="fa fa-check"></i>Program 16.3</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.4"><i class="fa fa-check"></i>Program 16.4</a></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation.html"><a href="instrumental-variables-estimation.html#program-16.5"><i class="fa fa-check"></i>Program 16.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html"><i class="fa fa-check"></i>17. Causal survival analysis</a><ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.1"><i class="fa fa-check"></i>Program 17.1</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.2"><i class="fa fa-check"></i>Program 17.2</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.3"><i class="fa fa-check"></i>Program 17.3</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.4"><i class="fa fa-check"></i>Program 17.4</a></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis.html"><a href="causal-survival-analysis.html#program-17.5"><i class="fa fa-check"></i>Program 17.5</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="r-session-information.html"><a href="r-session-information.html"><i class="fa fa-check"></i>R session information</a></li>
<li class="part"><span><b>Stata code</b></span></li>
<li class="chapter" data-level="" data-path="why-model-1.html"><a href="why-model-1.html"><i class="fa fa-check"></i>11. Why model?</a><ul>
<li class="chapter" data-level="" data-path="why-model-1.html"><a href="why-model-1.html#program-11.1-1"><i class="fa fa-check"></i>Program 11.1</a></li>
<li class="chapter" data-level="" data-path="why-model-1.html"><a href="why-model-1.html#program-11.2-1"><i class="fa fa-check"></i>Program 11.2</a></li>
<li class="chapter" data-level="" data-path="why-model-1.html"><a href="why-model-1.html#program-11.3-1"><i class="fa fa-check"></i>Program 11.3</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models</a><ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html#program-12.1-1"><i class="fa fa-check"></i>Program 12.1</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html#program-12.2-1"><i class="fa fa-check"></i>Program 12.2</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html#program-12.3-1"><i class="fa fa-check"></i>Program 12.3</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html#fine-point-12.2-checking-positivity"><i class="fa fa-check"></i>Fine point 12.2: Checking positivity</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html#program-12.4-1"><i class="fa fa-check"></i>Program 12.4</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html#program-12.5-1"><i class="fa fa-check"></i>Program 12.5</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html#program-12.6-1"><i class="fa fa-check"></i>Program 12.6</a></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-1.html"><a href="ip-weighting-and-marginal-structural-models-1.html#program-12.7-1"><i class="fa fa-check"></i>Program 12.7</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-1.html"><a href="standardization-and-the-parametric-g-formula-1.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula</a><ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-1.html"><a href="standardization-and-the-parametric-g-formula-1.html#program-13.1-1"><i class="fa fa-check"></i>Program 13.1</a></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-1.html"><a href="standardization-and-the-parametric-g-formula-1.html#program-13.2-1"><i class="fa fa-check"></i>Program 13.2</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-1.html"><a href="g-estimation-of-structural-nested-models-1.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models</a><ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-1.html"><a href="g-estimation-of-structural-nested-models-1.html#program-14.1-1"><i class="fa fa-check"></i>Program 14.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-1.html"><a href="outcome-regression-and-propensity-scores-1.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores</a><ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-1.html"><a href="outcome-regression-and-propensity-scores-1.html#program-15.1-1"><i class="fa fa-check"></i>Program 15.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-1.html"><a href="instrumental-variables-estimation-1.html"><i class="fa fa-check"></i>16. Instrumental variables estimation</a><ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-1.html"><a href="instrumental-variables-estimation-1.html#program-16.1-1"><i class="fa fa-check"></i>Program 16.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-1.html"><a href="causal-survival-analysis-1.html"><i class="fa fa-check"></i>17. Causal survival analysis</a><ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis-1.html"><a href="causal-survival-analysis-1.html#program-17.1-1"><i class="fa fa-check"></i>Program 17.1</a></li>
</ul></li>
<li class="part"><span><b>Python code</b></span></li>
<li class="chapter" data-level="" data-path="why-model-2.html"><a href="why-model-2.html"><i class="fa fa-check"></i>11. Why model?</a><ul>
<li class="chapter" data-level="" data-path="why-model-2.html"><a href="why-model-2.html#program-11.1-2"><i class="fa fa-check"></i>Program 11.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-2.html"><a href="ip-weighting-and-marginal-structural-models-2.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models</a><ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-2.html"><a href="ip-weighting-and-marginal-structural-models-2.html#program-12.1-2"><i class="fa fa-check"></i>Program 12.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-2.html"><a href="standardization-and-the-parametric-g-formula-2.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula</a><ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-2.html"><a href="standardization-and-the-parametric-g-formula-2.html#program-13.1-2"><i class="fa fa-check"></i>Program 13.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-2.html"><a href="g-estimation-of-structural-nested-models-2.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models</a><ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-2.html"><a href="g-estimation-of-structural-nested-models-2.html#program-14.1-2"><i class="fa fa-check"></i>Program 14.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-2.html"><a href="outcome-regression-and-propensity-scores-2.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores</a><ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-2.html"><a href="outcome-regression-and-propensity-scores-2.html#program-15.1-2"><i class="fa fa-check"></i>Program 15.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-2.html"><a href="instrumental-variables-estimation-2.html"><i class="fa fa-check"></i>16. Instrumental variables estimation</a><ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-2.html"><a href="instrumental-variables-estimation-2.html#program-16.1-2"><i class="fa fa-check"></i>Program 16.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-2.html"><a href="causal-survival-analysis-2.html"><i class="fa fa-check"></i>17. Causal survival analysis</a><ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis-2.html"><a href="causal-survival-analysis-2.html#program-17.1-2"><i class="fa fa-check"></i>Program 17.1</a></li>
</ul></li>
<li class="part"><span><b>SAS code</b></span></li>
<li class="chapter" data-level="" data-path="why-model-3.html"><a href="why-model-3.html"><i class="fa fa-check"></i>11. Why model?</a><ul>
<li class="chapter" data-level="" data-path="why-model-3.html"><a href="why-model-3.html#program-11.1-3"><i class="fa fa-check"></i>Program 11.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-3.html"><a href="ip-weighting-and-marginal-structural-models-3.html"><i class="fa fa-check"></i>12. IP Weighting and Marginal Structural Models</a><ul>
<li class="chapter" data-level="" data-path="ip-weighting-and-marginal-structural-models-3.html"><a href="ip-weighting-and-marginal-structural-models-3.html#program-12.1-3"><i class="fa fa-check"></i>Program 12.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-3.html"><a href="standardization-and-the-parametric-g-formula-3.html"><i class="fa fa-check"></i>13. Standardization and the parametric G-formula</a><ul>
<li class="chapter" data-level="" data-path="standardization-and-the-parametric-g-formula-3.html"><a href="standardization-and-the-parametric-g-formula-3.html#program-13.1-3"><i class="fa fa-check"></i>Program 13.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-3.html"><a href="g-estimation-of-structural-nested-models-3.html"><i class="fa fa-check"></i>14. G-estimation of Structural Nested Models</a><ul>
<li class="chapter" data-level="" data-path="g-estimation-of-structural-nested-models-3.html"><a href="g-estimation-of-structural-nested-models-3.html#program-14.1-3"><i class="fa fa-check"></i>Program 14.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-3.html"><a href="outcome-regression-and-propensity-scores-3.html"><i class="fa fa-check"></i>15. Outcome regression and propensity scores</a><ul>
<li class="chapter" data-level="" data-path="outcome-regression-and-propensity-scores-3.html"><a href="outcome-regression-and-propensity-scores-3.html#program-15.1-3"><i class="fa fa-check"></i>Program 15.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-3.html"><a href="instrumental-variables-estimation-3.html"><i class="fa fa-check"></i>16. Instrumental variables estimation</a><ul>
<li class="chapter" data-level="" data-path="instrumental-variables-estimation-3.html"><a href="instrumental-variables-estimation-3.html#program-16.1-3"><i class="fa fa-check"></i>Program 16.1</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="causal-survival-analysis-3.html"><a href="causal-survival-analysis-3.html"><i class="fa fa-check"></i>17. Causal survival analysis</a><ul>
<li class="chapter" data-level="" data-path="causal-survival-analysis-3.html"><a href="causal-survival-analysis-3.html#program-17.1-3"><i class="fa fa-check"></i>Program 17.1</a></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Causal Inference Book: Exercises</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="standardization-and-the-parametric-g-formula-1" class="section level1 unnumbered">
<h1>13. Standardization and the parametric G-formula</h1>
<div class="sourceCode" id="cb355"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb355-1" data-line-number="1"><span class="kw">library</span>(Statamarkdown)</a></code></pre></div>
<div id="program-13.1-1" class="section level2">
<h2>Program 13.1</h2>
<ul>
<li>Estimating the mean outcome within levels of treatment and confounders</li>
<li>Data from NHEFS</li>
</ul>
<pre class="stata"><code>use ./data/nhefs-2, clear&quot;</code></pre>
<pre class="stata"><code>* Estimate the the conditional mean outcome within strata of quitting 
* smoking and covariates, among the uncensored
glm wt82_71 qsmk sex race c.age##c.age ib(last).education ///
  c.smokeintensity##c.smokeintensity c.smokeyrs##c.smokeyrs ///
  ib(last).exercise ib(last).active c.wt71##c.wt71 qsmk##c.smokeintensity
predict meanY
summarize meanY

* Look at the predicted value for subject ID = 24770
list meanY if seqn == 24770

* Observed mean outcome for comparison
summarize wt82_71</code></pre>
</div>
<div id="program-13.2-1" class="section level2">
<h2>Program 13.2</h2>
<ul>
<li>Standardizing the mean outcome to the baseline confounders</li>
<li>Data from Table 2.2</li>
</ul>
<pre class="stata"><code>qui input str10 ID L A Y
&quot;Rheia&quot;     0 0 0 
&quot;Kronos&quot;    0 0 1 
&quot;Demeter&quot;   0 0 0 
&quot;Hades&quot;     0 0 0 
&quot;Hestia&quot;    0 1 0 
&quot;Poseidon&quot;  0 1 0 
&quot;Hera&quot;      0 1 0 
&quot;Zeus&quot;      0 1 1 
&quot;Artemis&quot;   1 0 1
&quot;Apollo&quot;    1 0 1
&quot;Leto&quot;      1 0 0
&quot;Ares&quot;      1 1 1
&quot;Athena&quot;    1 1 1
&quot;Hephaestus&quot; 1 1 1
&quot;Aphrodite&quot; 1 1 1
&quot;Cyclope&quot;   1 1 1
&quot;Persephone&quot; 1 1 1
&quot;Hermes&quot;    1 1 0
&quot;Hebe&quot;      1 1 0
&quot;Dionysus&quot;  1 1 0 
end

* i.Data set up for standardization: create 3 copies of each subject
* first, duplicate the dataset and create a variable &#39;interv&#39; which indicates 
* which copy is the duplicate (interv =1)
* expand 2, generate(interv)
* next, duplicate the original copy (interv = 0) again, and create another 
* variable &#39;interv2&#39; to indicate the copy
* expand 2 if interv == 0, generate(interv2)
* now, change the value of &#39;interv&#39; to -1 in one of the copies so that there 
* are unique values of interv for each copy*
replace interv = -1  if interv2 ==1
drop interv2 

* check that the data has the structure you want: there should be 1566 people 
* in each of the 3 levels of interv
tab interv

* two of the copies will be for computing the standardized result
* for these two copies (interv = 0 and interv = 1), set the outcome to missing 
* and force qsmk to either 0 or 1, respectively
* you may need to edit this part of the code for your outcome and exposure variables
replace Y = . if interv != -1
replace A = 0 if interv == 0
replace A = 1 if interv == 1

* check that the data has the structure you want: for interv = -1, 
* some people quit and some do not; 
* for interv = 0 or 1, noone quits or everyone quits, respectively
by interv, sort: summarize A

* ii.Estimation in original sample
*Now, we do a parametric regression with the covariates we want to adjust for*
*You may need to edit this part of the code for the variables you want.*
*Because the copies have missing Y, this will only run the regression in the original copy*
*The double hash between A &amp; L creates a regression model with A and L and a product term between A and L*
regress Y A##L
*Ask Stata for expected values - Stata will give you expected values for all copies, not just the original ones*
predict predY, xb
*Now ask for a summary of these values by intervention*
*These are the standardized outcome estimates: you can subtract them to get the standardized difference*
by interv, sort: summarize predY

*iii.OPTIONAL: Output standardized point estimates and difference*
*The summary from the last command gives you the standardized estimates*
*We can stop there, or we can ask Stata to calculate the standardized difference and display all the results in a simple table*
*The code below can be used as-is without changing any variable names*
*The option &quot;quietly&quot; asks Stata not to display the output of some intermediate calculations*
*You can delete this option if you want to see what is happening step-by-step*
quietly summarize predY if(interv == -1)
matrix input observe = (-1,`r(mean)&#39;)
quietly summarize predY if(interv == 0)
matrix observe = (observe \0,`r(mean)&#39;)
quietly summarize predY if(interv == 1)
matrix observe = (observe \1,`r(mean)&#39;)
matrix observe = (observe \., observe[3,2]-observe[2,2]) 
*Add some row/column descriptions and print results to screen*
matrix rownames observe = observed E(Y(a=0)) E(Y(a=1)) difference
matrix colnames observe = interv value
matrix list observe 
*to interpret these results:*
*row 1, column 2, is the observed mean outcome value in our original sample*
*row 2, column 2, is the mean outcome value if everyone had not quit smoking*
*row 3, column 2, is the mean outcome value if everyone had quit smoking*
*row 4, column 2, is the mean difference outcome value if everyone had quit smoking compared to if everyone had not quit smoking*


/***************************************************************
 PROGRAM 13.3
Standardizing the mean outcome to the baseline confounders:
Data from NHEFS
***************************************************************/

clear
use &quot;nhefs.dta&quot;

*i.Data set up for standardization: create 3 copies of each subject*
*first, duplicate the dataset and create a variable &#39;interv&#39; which indicates which copy is the duplicate (interv =1)
expand 2, generate(interv)
*next, duplicate the original copy (interv = 0) again, and create another variable &#39;interv2&#39; to indicate the copy
expand 2 if interv == 0, generate(interv2)
*now, change the value of &#39;interv&#39; to -1 in one of the copies so that there are unique values of interv for each copy*
replace interv = -1  if interv2 ==1
drop interv2 
*check that the data has the structure you want: there should be 1566 people in each of the 3 levels of interv*
tab interv
*two of the copies will be for computing the standardized result*
*for these two copies (interv = 0 and interv = 1), set the outcome to missing and force qsmk to either 0 or 1, respectively*
*you may need to edit this part of the code for your outcome and exposure variables*
replace wt82_71 = . if interv != -1
replace qsmk = 0 if interv == 0
replace qsmk = 1 if interv == 1
*check that the data has the structure you want: for interv = -1, some people quit and some do not; for interv = 0 or 1, noone quits or everyone quits, respectively*
by interv, sort: summarize qsmk

*ii.Estimation in original sample*
*Now, we do a parametric regression with the covariates we want to adjust for*
*You may need to edit this part of the code for the variables you want.*
*Because the copies have missing wt82_71, this will only run the regression in the original copy*
regress wt82_71 qsmk sex race c.age##c.age ib(last).education c.smokeintensity##c.smokeintensity c.smokeyrs##c.smokeyrs ib(last).exercise ib(last).active c.wt71##c.wt71 qsmk#c.smokeintensity
*Ask Stata for expected values - Stata will give you expected values for all copies, not just the original ones*
predict predY, xb
*Now ask for a summary of these values by intervention*
*These are the standardized outcome estimates: you can subtract them to get the standardized difference*
by interv, sort: summarize predY

*iii.OPTIONAL: Output standardized point estimates and difference*
*The summary from the last command gives you the standardized estimates*
*We can stop there, or we can ask Stata to calculate the standardized difference and display all the results in a simple table*
*The code below can be used as-is without changing any variable names*
*The option &quot;quietly&quot; asks Stata not to display the output of some intermediate calculations*
*You can delete this option if you want to see what is happening step-by-step*
quietly summarize predY if(interv == -1)
matrix input observe = (-1,`r(mean)&#39;)
quietly summarize predY if(interv == 0)
matrix observe = (observe \0,`r(mean)&#39;)
quietly summarize predY if(interv == 1)
matrix observe = (observe \1,`r(mean)&#39;)
matrix observe = (observe \., observe[3,2]-observe[2,2]) 
*Add some row/column descriptions and print results to screen*
matrix rownames observe = observed E(Y(a=0)) E(Y(a=1)) difference
matrix colnames observe = interv value
matrix list observe 
*to interpret these results:*
*row 1, column 2, is the observed mean outcome value in our original sample*
*row 2, column 2, is the mean outcome value if everyone had not quit smoking*
*row 3, column 2, is the mean outcome value if everyone had quit smoking*
*row 4, column 2, is the mean difference outcome value if everyone had quit smoking compared to if everyone had not quit smoking*



/***************************************************************
PROGRAM 13.4
Computing the 95% confidence interval of the standardized means 
and their difference: Data from NHEFS
***************************************************************/

*Run program 13.3 to obtain point estimates, and then the code below*

*drop the copies*
drop if interv != -1
gen meanY_b =.
save nhefs_std, replace
capture program drop bootstdz
program define bootstdz, rclass
    u nhefs_std, clear
        preserve
        *draw bootstrap sample from original observations*
        bsample 
        *create copies with each value of qsmk in bootstrap sample*
        *first, duplicate the dataset and create a variable &#39;interv&#39; which indicates which copy is the duplicate (interv =1)
        expand 2, generate(interv_b)
        *next, duplicate the original copy (interv = 0) again, and create another variable &#39;interv2&#39; to indicate the copy
        expand 2 if interv_b == 0, generate(interv2_b)
        *now, change the value of &#39;interv&#39; to -1 in one of the copies so that there are unique values of interv for each copy*
        replace interv_b = -1  if interv2_b ==1
        drop interv2_b
        *two of the copies will be for computing the standardized result*
        *for these two copies (interv = 0 and interv = 1), set the outcome to missing and force qsmk to either 0 or 1, respectively*
        replace wt82_71 = . if interv_b != -1
        replace qsmk = 0 if interv_b == 0
        replace qsmk = 1 if interv_b == 1
        *run regression*
        regress wt82_71 qsmk sex race c.age##c.age ib(last).education c.smokeintensity##c.smokeintensity c.smokeyrs##c.smokeyrs ib(last).exercise ib(last).active c.wt71##c.wt71 qsmk#c.smokeintensity
        *Ask Stata for expected values - Stata will give you expected values for all copies, not just the original ones*
        predict predY_b, xb
        summarize predY_b if interv_b == 0
        return scalar boot_0 = r(mean)
        summarize predY_b if interv_b == 1
        return scalar boot_1 = r(mean)
        return scalar boot_diff = return(boot_1) - return(boot_0)
    drop meanY_b
    restore
end

*Then we use the &#39;simulate&#39; command to run the bootstraps as many times as we want*
*Start with reps(10) to make sure your code runs, and then change to reps(1000) to generate your final CIs*
simulate EY_a0=r(boot_0) EY_a1 = r(boot_1) difference = r(boot_diff), reps(10) seed(1): bootstdz /

*Next, format the point estimate to allow Stata to calculate our standard errors and confidence intervals
matrix pe = observe[2..4, 2]&#39;
matrix list pe

*Finally, the bstat command generates valid 95% confidence intervals under the normal approximation using our bootstrap results*
*The default results use a normal approximation to calcutlate the confidence intervals*
*note, n contains the original sample size of your data before censoring*
bstat, stat(pe) n(1629) 

*If you would prefer percentile confidence intervals then you can use the estat commandwith the &#39;p&#39; option*
estat bootstrap, p</code></pre>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="ip-weighting-and-marginal-structural-models-1.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="g-estimation-of-structural-nested-models-1.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": false,
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/remlapmot/cibookex/edit/master/13-stand-gformula-stata.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"download": ["cibookex.pdf", "cibookex.epub"],
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
